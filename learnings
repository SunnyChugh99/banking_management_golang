 docker run --name postgres13 -p 5433:5433 -e POSTGRES_PASSWORD=secret -e POSTGRES_USER=root -d postgres:12-alpine


Golang database migration

migrate package in Golang

 migrate create -ext sql -dir db/migration -seq init_schema



sudo systemctl stop postgresql




docker run --name postgres17 -p 5433:5432 -e POSTGRES_PASSWORD=secret -e POSTGRES_USER=root -d postgres:12-alpine

-------------------------------------------------------------------------------------------------------------------------------------------------
Migration up:
-------------------------------------------------------------------------------------------------------------------------------------------------
migrate -path db/migration -database "postgres://root:secret@localhost:5433/simple_bank?sslmode=disable" -verbose up



DATABASE/sql
 - very fast and straightforward
 - manual mapping SQL fields to variables
 - Easy to make mistakes, not caught at runtime


GORM
 - CRUD operations already implemented, very short prod code
 - must learn how to write complex queries using gorm's functions
 - Run slowly on high traffic


 SQLX 
 - Quite fast & easy to use
 - Field mapping via query text & struct tags
 - Failure won't occur until runtime   

 SQLC
 - Very fast & easy to use
 - Automatic code generation
 - Catch SQL query errors before generating codes
 - Full support postgres, mysql is experimental


 TESTING FRAMEWORK

 TESTIFY package



 docker run --name bankmanagement -p 080 -e DBSOURCE="postgres://root:secret@172.17.0.2:5432/simple_bank?sslmode=disable" sunnydocker1209/bank_management:v1


AWS password:

RDS databae:

user-  root 

password - vOe5Go2oTKtBIFSE60I7
host - simple-bank.cfaqkm6kysnc.eu-west-1.rds.amazonaws.com


migrateup:

migrate -path db/migration -database "postgres://root:vOe5Go2oTKtBIFSE60I7@simple-bank.cfaqkm6kysnc.eu-west-1.rds.amazonaws.com:5432/simple_bank" -verbose up


TOKEN_SYMMETRIC_KEY d316cf2a654bc266c875c08212fcf8cc




aws ssm code:

// Use this code snippet in your app.
// If you need more information about configurations or implementing the sample code, visit the AWS docs:   
// https://aws.github.io/aws-sdk-go-v2/docs/getting-started/

import (
	"context"
	"log"

	"github.com/aws/aws-sdk-go-v2/aws"
	"github.com/aws/aws-sdk-go-v2/config"
	"github.com/aws/aws-sdk-go-v2/service/secretsmanager"
)

func main() {
	secretName := "simple_bank"
	region := "eu-west-1"

	config, err := config.LoadDefaultConfig(context.TODO(), config.WithRegion(region))
	if err != nil {
		log.Fatal(err)
	}

	// Create Secrets Manager client
	svc := secretsmanager.NewFromConfig(config)

	input := &secretsmanager.GetSecretValueInput{
		SecretId:     aws.String(secretName),
		VersionStage: aws.String("AWSCURRENT"), // VersionStage defaults to AWSCURRENT if unspecified
	}

	result, err := svc.GetSecretValue(context.TODO(), input)
	if err != nil {
		// For a list of exceptions thrown, see
		// https://docs.aws.amazon.com/secretsmanager/latest/apireference/API_GetSecretValue.html
		log.Fatal(err.Error())
	}

	// Decrypts secret using the associated KMS key.
	var secretString string = *result.SecretString

	// Your code goes here.
}


curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install



aws access_key_id - AKIAW3MECL3YPZUT6SGQ

secret_key : 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


SECRET ARN : arn:aws:secretsmanager:eu-west-1:471112769264:secret:simple_bank-V855WG


aws secretsmanager get-secret-value --secret-id simple_bank --query SecretString --output text
aws secretsmanager get-secret-value --secret-id simple_bank --query SecretString --output text


10683796@ltilbom20401298:~/Desktop/EVERYTHING/Learnings/SKILLS_LEARNINGS/banking_management_golang$ aws secretsmanager get-secret-value --secret-id simple_bank --query SecretString --output text | jq -r 'to_entries|map("\(.key)=\(.value)")|.[]' 
DB_DRIVER=postgres
DB_SOURCE=postgres://root:vOe5Go2oTKtBIFSE60I7@simple-bank.cfaqkm6kysnc.eu-west-1.rds.amazonaws.com:5432/simple_bank
SERVER_ADDRESS=0.0.0.0:8080
TOKEN_SYMMETRIC_KEY=d316cf2a654bc266c875c08212fcf8cc
ACCESS_TOKEN_DURATION=15m
10683796@ltilbom20401298:~/Desktop/EVERYTHING/Learnings/SKILLS_LEARNINGS/banking_management_golang$ aws secretsmanager get-secret-value --secret-id simple_bank --query SecretString --output text | jq -r 'to_entries|map("\(.key)=\(.value)")|.[]' > app.env



10683796@ltilbom20401298:~/Desktop/EVERYTHING/Learnings/SKILLS_LEARNINGS/banking_management_golang$ aws ecr get-login-password


eyJwYXlsb2FkIjoidjd0SG5lNFFueDA2RTRyNzVGNmk2L1RGeFR0WjlWaS83NUZ6cTNlOUp3U2NUeGxtSFVhZHB0UEsvSjBEYnMvNzVTTmZhVy9td2FaQlZyVytDNkFMTTM5UG9vZVlTcWVCTjZYZkRteWV5VEtiOExjTHh6QzNKWGNsR2RyUnJRdnNkcXV3cTE1WVhNN0xkVFBIZStmZDB0Umd3ZndoNHFEZlFBRXArQk5OQ1hYMStiWHpjMmsvWXh4YWdRelJMVjM4STlXNy9GbXdiT091TnpVejBsd2xwMVNZd2R5RC9YTXFMeHV5QUYxekJkWlAzZWN6MFBoVkRRRVBWQldxeVQ3eXJJaUFZNTQvZ3RWVlE3TjlGeFZIK2pibmNGODZSZ2R0TXVxNi8rVGwxVUZnSnAvNFFidU4ya1dVeGxMdFFzTFNzWTlCV0N1UlEvc0lwL1NTNkJhRURmZUIwcGdGQmQ4OWxMOU8zSU9VTWZoOXpHNGtLeVZaQUZhSGFVcjVRZTg4ZEw0aEFyMUVXN0YrbDl6QmlIWE5SREtsNllDL1BTb3R1MHliQWlERWRNWVJEWjRoRWoyNTl6cU85L01Ib2I1Uk9TTzRxNHJ6MUllZFZjSmgyVVZicklrUCtFakU5QnE5YW5yMzNOUzI0ajl5OE02M3VqUEJLTGJHc21oNlEveG9aNUs4aFRiZHp4WEFyS3dsZlliSzJRWXYzdzlrNXRWZkdROWlDUHNzV2NNWEs2cFdsdUxXckVpditiZDBycVhlS3VQRGxJQ2pPWHo4ekFBWVNBMlRPV1R5Vm5wL3JjTmRuWFloT2Z1N1pVOE9oUXBjL04rZTJIRUJiVmVNS2RtWkpqUGFUU3pqa2UzWm1xWFR1T0ZNbUxJRXZTeVRlaG5NQThJb0V3Q0Z6R29QWWpUaHlYOUd4YXdBNUcrTkZwZzd2elBpNWV2TWZtYkFaUGsvc1ZnNnY2U3A1bTZZYlpiVW5xMEQyeFBUVXo1d28yQUg3eHZybGN5UHMrL3IwT0IvS0JGaFBBNEpEOGM4MGdBb050WkxGQ3h3Y3pibFJVYVMra1hNd0pyZXJ3UEhPa2VoU3dBODNYRGJHSDM2RDhQNWxPRDlyTS9RR3I2WlROSXljcmNzSm5kTUd1YjVPS2dKSHNQR2pmQ253V3BXTjJOQU9LdW9Yb2lMRkFPQkRlMStOTGh6eGdoa3o5YkRTT2szSXFlRFJxaE04SHZjTWM1aEdlTXhUMm1vTkRqcmlkdU12MHF4QUEwTXdrQmozZFUxQlQ4QTRLSXJjdStwNDQ5R01pT3cyZVk3V01nRmFmMnd0elVsY3BtREUxYzVUb2t1ZEFpejRqRElBVXl6UzVTRnU0SUNCejFVemtJNE9GZUFrUT09IiwiZGF0YWtleSI6IkFRRUJBSGgrZFMrQmxOdTBOeG5Yd293YklMczExNXlqZCtMTkFaaEJMWnN1bk94azNBQUFBSDR3ZkFZSktvWklodmNOQVFjR29HOHdiUUlCQURCb0Jna3Foa2lHOXcwQkJ3RXdIZ1lKWUlaSUFXVURCQUV1TUJFRURINHNSV2R4dWR3L0Q5OVFvUUlCRUlBNzRKL0RlKzRDb0tpVG1Oa2V2Qzh2N21BR0ovL1lwdUxFbXdDWk5aR0V3Y2lFci9QM0s2Q1R5T1dWbTc5OVpxdWpPWjdoVWsrejBOMEh0ODQ9IiwidmVyc2lvbiI6IjIiLCJ0eXBlIjoiREFUQV9LRVkiLCJleHBpcmF0aW9uIjoxNzA4MjkxODUxfQ==



aws ecr get-login-password | docker login --username AWS --password-stdin 471112769264.dkr.ecr.eu-west-1.amazonaws.com


ROOT wala created in k8 lecture
access-key ==> AKIAW3MECL3YEX5UEKQF

secret-key ==>  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


docker login -u sunnydocker1209
dckr_pat_GKwEJj1hWilroJDzAIQFUEdjmU0


docker push sunnydocker1209/bank_management:test1

docker build -t sunnydocker1209/bank_management:test1 .



sunnycode
secret
